<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>GitHub完結型AIチャット</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        #output { background: #f0f0f0; padding: 10px; min-height: 100px; margin-top: 10px; border-radius: 5px; white-space: pre-wrap; }
        textarea { width: 100%; height: 80px; }
    </style>
</head>
<body>
    <h1>マイAIチャット (Local LLM)</h1>
    <p>※初回はAIモデル(約1GB)のダウンロードに数分かかります。</p>
    <textarea id="input" placeholder="ここにメッセージを入力..."></textarea>
    <button id="sendBtn">送信</button>
    <div id="output">AIの準備を待っています...</div>

    <script type="module">
        // Transformers.jsライブラリを使ってブラウザでAIを動かす
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.1';

        let generator;
        const outputDiv = document.getElementById('output');

        async function init() {
            try {
                // 日本語対応の軽量モデルをロード
                generator = await pipeline('text-generation', 'onnx-community/Qwen2.5-0.5B-Instruct');
                outputDiv.innerText = "準備完了！質問をどうぞ。";
            } catch (e) {
                outputDiv.innerText = "エラーが発生しました: " + e.message;
            }
        }

        document.getElementById('sendBtn').onclick = async () => {
            const text = document.getElementById('input').value;
            if (!text || !generator) return;
            
            outputDiv.innerText = "思考中...";
            const messages = [{ role: "user", content: text }];
            
            const output = await generator(messages, { max_new_tokens: 128 });
            outputDiv.innerText = output[0].generated_text.at(-1).content;
        };

        init();
    </script>
</body>
</html>
